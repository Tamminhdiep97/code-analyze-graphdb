services:
  code-analysis-api:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: code-analysis-api
    ports:
      - "8000:8000"
    volumes:
      - ./uploads:/app/uploads
      - ./api:/app/api
      - ./config:/app/config
      - ./core:/app/core
      - ./tests:/app/tests
      - ./experiment:/app/experiment  # Keep existing experiment code
    environment:
      - GRAPH_HOST=graphd  # Assuming Nebula is available at 'graphd' in the network
      - GRAPH_PORT=9669
      - GRAPH_USER=root
      - GRAPH_PASSWORD=123123
      - UPLOAD_FOLDER=/app/uploads
    networks:
      - code-review-external-network
    restart: unless-stopped
    command: uvicorn api.v1.app:app --host 0.0.0.0 --port 8000

networks:
  code-review-external-network:
    external: true
